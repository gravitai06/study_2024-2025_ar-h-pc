%include 'in_out.asm'  ; подключение внешнего файла

SECTION .data          ; секция инициалированных данных
msg: DB 'Введите значение переменной x: ',0
res: DB 'Результат: ',0

SECTION .bss           ; секция неинициализированных данных
x: RESB 80             ; Переменная для хранения значения, вводимого с клавиатуры

SECTION .text          ; Код программы
GLOBAL _start          ; Начало программы
_start:                ; Точка входа в программу

    ; ---- Ввод значения x ----
    mov eax, msg       ; Адрес выводимого сообщения в eax
    call sprint        ; Вызов подпрограммы для печати сообщения
    mov ecx, x         ; Запись адреса переменной x в ecx
    mov edx, 80        ; Указание длины вводимого значения в edx
    call sread         ; Вызов подпрограммы для ввода значения

    mov eax, x         ; Преобразование ASCII в число
    call atoi          ; Преобразование ASCII кода в число, теперь `eax = x`

    ; ---- Вычисление выражения (8x - 6) / 2 ----
    mov ebx, 8         ; Установка значения 8 в ebx
    mul ebx            ; Умножение: EAX = EAX * EBX = x * 8
    sub eax, 6         ; Вычитание 6: EAX = EAX - 6 = 8x - 6

    mov ebx, 2         ; Установка значения 2 в ebx для деления
    cdq                ; Расширение EAX в EDX:EAX для корректной работы div
    div ebx            ; Деление: EAX = (8x - 6) / 2

    ; ---- Вывод результата ----
    mov eax, res       ; Адрес строки 'Результат: ' в eax
    call sprint        ; Вызов подпрограммы для печати сообщения

    mov eax, eax       ; Вызов подпрограммы для печати значения
    call iprintLF      ; Вывод результата на экран
